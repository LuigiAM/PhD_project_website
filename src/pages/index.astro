---
import Layout from '../layouts/Layout.astro';
import ShareButtons from '../components/ShareButtons.astro';
import NavCard from '../components/NavCard.astro';
import IconTarget from '../components/icons/IconTarget.astro';
import IconChip from '../components/icons/IconChip.astro';
import IconEye from '../components/icons/IconEye.astro';
import IconUvpCheck from '../components/icons/IconUvpCheck.astro';
import IconCheckCircle from '../components/icons/IconCheckCircle.astro';
import DemoCard from '../components/DemoCard.astro';

const testimonials = [
  { quote: "Wow. Good to see the project moving along so fast.", author: "Co-design participant from the public" },
  { quote: "Great newsletter! üòä", author: "BNSSG (NHS) Senior Research Fellow" },
  { quote: "Thank you for the update, Luigi. I look forward to reading the newsletter.", author: "Co-design participant from the public" },
  { quote: "Thank you so much for the update, it's wonderful to hear of all this progress.", author: "Associate Professor in Clinical Research" }
];

const acronymLines = [
  { letter: "M", text: "ultimodal" },
  { letter: "E", text: "motion" },
  { letter: "Mo", text: "nitoring" },
  { text: "in Clinical" },
  { letter: "P", text: "athways for" },
  { letter: "A", text: "nxiety" },
  { letter: "D", text: "isorders" }
];
---
<Layout
  title="MEMoPAD | Multimodal Emotion Monitoring for Anxiety Disorders"
  description="The MEMOPAD project, led by Luigi A. Moretti. A PhD initiative co-designing a human-centered digital tool to provide clear, continuous, and interpretable emotion data for anxiety care.<br> This project aims to bridge the gap between technology and mental health, offering innovative solutions for anxiety management."
>
  <section class="hero">
    <div class="hero-content">
      <h1 class="animated-title">
        <div class="acronym-breakdown">
          {acronymLines.map(line => (
            <div class="acronym-line">
              <span class="acronym-letter">{line.letter}</span>
              <span class="acronym-text" data-text={line.text}></span>
            </div>
          ))}
        </div>
      </h1>
      <h3>
        We are co-designing a human-centered digital tool that uses technology to understand emotion responses, providing clear and continuous data to empower users and facilitate deeper conversations with clinicians.
      </h3>
    </div>
  </section>

  <section class="container nav-grid-wrapper">
    <div class="nav-grid">
      <NavCard 
        title="Meet the Team" 
        href="/project-story/#team-section" 
        imgSrc="/project-story-card.jpeg"
        alt="A sketch of a human head with interconnected nodes, representing the project team."
        linkTitle="Learn about the supervisory team behind the MEMoPAD project"
      />
      <NavCard 
        title="Our Co-Design Process" 
        href="/research/#methodology" 
        imgSrc="/our-codesign-plan.jpg"
        alt="A diagram showing the six phases of the human-centered co-design process."
        linkTitle="Explore the research methodology and co-design process"
      />
      <NavCard 
        title="View Awards & Funding" 
        href="/achievements/#funding-awards" 
        imgSrc="/MEMoPADpresentation.jpeg"
        alt="A presentation slide from the MEMoPAD project showing key data points."
        linkTitle="See the project's key awards, grants, and achievements"
      />
    </div>
  </section>

  <section class="container rationale-wrapper">
    <div class="rationale-grid">
      <div class="rationale-item">
        <div class="item-header"><IconTarget /><h2>The Clinical Need</h2></div>
        <p>Previous attempts to integrate structured data in mental health have faced persistent challenges, including the complexity of multimodal data, the social stigma that delays help-seeking, and difficulties in data interpretation which can hinder user engagement. We believe focusing on emotion can mitigate these issues by providing a universally understood common ground.</p>
      </div>
      <div class="rationale-item">
        <div class="item-header"><IconChip /><h2>Our Approach</h2></div>
        <p>Commercially available wearable devices feature increasingly sophisticated sensors at affordable prices, without the stigma associated with medical-looking hardware. Our approach focuses on data collected from consumer wearables and mobile phones to capture longitudinal and contextualised data through multimodal affective computing.</p>
      </div>
      <div class="rationale-item">
        <div class="item-header"><IconEye /><h2>Our Vision</h2></div>
        <p>Our goal is to co-design a digital tool that provides clear, continuous, and interpretable emotion data. We aim to help users understand themselves better, foster proactive self-management, and facilitate deeper, more effective conversations with their clinicians, ultimately improving pathways for anxiety care.</p>
      </div>
    </div>
  </section>

  {/* --- UNIQUE VALUE PROPOSITION SECTION --- */}
  <section class="container uvp-wrapper">
    <div class="uvp-callout">
      <h2>Our Unique Value Proposition</h2>
      <ul>
        <li>
          <IconUvpCheck />
          <span><strong>Emotion as a Common Language:</strong> We use emotion as a foundational layer to make complex multimodal data more understandable and to avoid the stigma of clinical labels or to trigger more anxiety.</span>
        </li>
        <li>
          <IconUvpCheck />
          <span><strong>Hybrid Data Fusion:</strong> We combine passive data from everyday wearables with active, user-provided content to create a richer, more complete picture of an individual's well-being and foster self-reflection.</span>
        </li>
        <li>
          <IconUvpCheck />
          <span><strong>Semi-Structured Context:</strong> The tool allows users to add context to their data in a simple way, making the insights personally relevant and clinically valuable.</span>
        </li>
        <li>
          <IconUvpCheck />
          <span><strong>Clinical Integration Focus:</strong> From the outset, the project is designed as a tool to be integrated directly into existing clinical pathways, supporting patients, clinicians, and carers.</span>
        </li>
      </ul>
    </div>
  </section>

  <section class="container alignment-wrapper">
    <div class="alignment-box">
      <div class="item-header">
        <IconCheckCircle />
        <h2>Alignment with UK Health Priorities</h2>
      </div>
      <p>
        The MEMoPAD project directly supports the UK's 10-Year Health Plan by developing the framework needed to integrate wearable devices and AI into clinical pathways. By empowering patients with their own data, we enable a more personalized approach to care. This focus on prevention addresses a key challenge identified by our co-design participants: supporting individuals in seeking help for the first time. By improving mental well-being, our work also contributes to the wider societal benefit of boosting workforce productivity and supporting people's mental health in daily as well as in challenging scenarios.
      </p>
    </div>
  </section>


  {/* --- VIDEO SHOWCASE SECTION --- */}
  <section class="container demo-wrapper">
    <div class="demo-header">
      <h2>See MEMoPAD in Action</h2>
      <p>Explore our progress through the latest video trailer of the mobile app and the interactive prototype of our web app for clinicians.</p>
    </div>
    <div class="demo-grid">
      <DemoCard
        title="Mobile App for Personal Use"
        description="A brief trailer showcasing the core features for mood logging, data visualization, and contextual note-taking."
        videoId="ZfFJO2GutQ"
      />
      <DemoCard
        title="Web App for Professionals"
        description="Navigate a clickable prototype of the clinician-facing dashboard. Click the image to explore."
        linkUrl="https://memopad-demo.luigiandreamoretti.com/"
        imgSrc="/preview-demo-webapp.jpg"
      />
    </div>
  </section>

  <section class="container featured-newsletter-wrapper">
    <div class="featured-newsletter">
      <div class="newsletter-content">
        <h2>Get Monthly Updates & Stay Connected</h2>
        <p>Join our mailing list for exclusive and prompt insights into our co-design process, recent findings, and upcoming milestones. No spam, just progress.</p>
        <div class="button-group">
          <a href="/newsletter" class="button button-secondary">Read the archive</a>
          <a href="mailto:luigi.moretti@uwe.ac.uk?subject=I want to subscribe to the newsletter" class="button">Subscribe</a>
        </div>
      </div>
      <div class="testimonial-column">
        <div class="testimonial-slider">
          {testimonials.map((testimonial) => (
            <div class="testimonial-card">
              <p class="quote">‚Äú{testimonial.quote}‚Äù</p>
              <p class="author">&mdash; {testimonial.author}</p>
            </div>
          ))}
        </div>
      </div>
    </div>
  </section>

  <div class="share-wrapper container">
    <ShareButtons 
      pageTitle="MEMoPAD: Help Shape the Future of Mental Health Tech" 
      shareDescription="In the MEMoPAD project, Luigi A. Moretti and his supervisory team are co-designing a digital tool for anxiety disorders that uses technology to understand and measure emotional responses..." 
    />
  </div>
</Layout>

<script>
  // Script for testimonial animation
  document.addEventListener('DOMContentLoaded', () => {
    const testimonialSlider = document.querySelector<HTMLElement>('.testimonial-slider');
    if (testimonialSlider) {
      const cards = Array.from(testimonialSlider.children) as HTMLElement[];
      if (cards.length > 1) {
        let currentIndex = 0;
        const setSliderHeight = () => {
          let maxHeight = 0;
          cards.forEach((card) => {
            card.style.position = 'static';
            if (card.offsetHeight > maxHeight) maxHeight = card.offsetHeight;
            card.style.position = 'absolute';
          });
          testimonialSlider.style.height = `${maxHeight}px`;
        };
        setSliderHeight();
        window.addEventListener('resize', setSliderHeight);
        cards.forEach((card, index) => { if(index !== 0) card.classList.add('is-waiting'); });
        cards[0].classList.add('is-active');
        setInterval(() => {
          const nextIndex = (currentIndex + 1) % cards.length;
          cards[currentIndex].classList.remove('is-active');
          cards[currentIndex].classList.add('is-leaving');
          cards[nextIndex].classList.add('is-active');
          cards[nextIndex].classList.remove('is-waiting');
          setTimeout(() => {
            cards[currentIndex].classList.remove('is-leaving');
            cards[currentIndex].classList.add('is-waiting');
            currentIndex = nextIndex;
          }, 800);
        }, 5000);
      }
    }

    // Script for H1 typing animation
    const textSpans = Array.from(document.querySelectorAll('.acronym-text')) as HTMLElement[];
    if (textSpans.length > 0) {
      let isTyping = true;
      let currentLine = 0;
      let currentChar = 0;
      const type = () => {
        if (!isTyping) return;
        const span = textSpans[currentLine];
        const fullText = span.dataset.text || '';
        span.textContent = fullText.substring(0, currentChar + 1);
        span.classList.add('has-cursor');
        if (currentChar < fullText.length) {
          currentChar++;
          setTimeout(type, 50);
        } else {
          span.classList.remove('has-cursor');
          currentLine++;
          currentChar = 0;
          if (currentLine < textSpans.length) {
            setTimeout(type, 200);
          } else {
            isTyping = false;
            setTimeout(() => { isTyping = true; erase(); }, 10000);
          }
        }
      };
      const erase = () => {
        if (!isTyping) return;
        let lineToDelete = textSpans.length - 1;
        const eraseChar = () => {
          const span = textSpans[lineToDelete];
          const fullText = span.dataset.text || '';
          
          // Use a fallback to ensure textContent is treated as a string
          span.textContent = fullText.substring(0, (span.textContent || '').length - 1);
          span.classList.add('has-cursor');
          if ((span.textContent || '').length > 0) {
            setTimeout(eraseChar, 30);
          } else {
            span.classList.remove('has-cursor');
            lineToDelete--;
            if (lineToDelete >= 0) {
              eraseChar();
            } else {
              isTyping = false;
              currentLine = 0;
              setTimeout(() => { isTyping = true; type(); }, 500);
            }
          }
        };
        eraseChar();
      };
      type();
    }
  });
</script>

<style>
  /* --- STYLES FOR ANIMATED H1 --- */
  .animated-title {
    display: flex;
    justify-content: center;
    padding: 2rem 0;
  }
  .acronym-breakdown {
    text-align: left;
    font-size: 2rem;
    font-weight: 500;
    line-height: 1.6;
  }
  .acronym-line {
    display: flex;
    align-items: baseline;
  }
  .acronym-letter {
    color: var(--color-primary);
    font-weight: 700;
    padding-right: 0.4rem;
    min-width: 4rem;
    text-align: right;
  }
  .acronym-text {
    position: relative;
  }
  .acronym-text.has-cursor::after {
    content: '';
    position: absolute;
    right: -0.2em;
    top: 0.1em;
    bottom: 0.1em;
    width: 2px;
    background: var(--color-text);
    animation: blink 1s steps(1) infinite;
  }
  @keyframes blink { 50% { opacity: 0; } }
  
  @media (min-width: 768px) {
    .acronym-breakdown {
      font-size: 2.5rem;
    }
  }

  /* --- HERO AND OTHER STYLES --- */
  .hero {
    min-height: 70vh;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
  }
  .hero-content { max-width: 800px; padding: 0 2rem; }
  .hero h3 { font-size: 1.125rem; font-weight: 400; line-height: 1.6; max-width: 650px; margin: 0 auto; color: var(--color-text-muted); }
  
  .nav-grid-wrapper { padding-top: 2rem; padding-bottom: 2rem; }
  .nav-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; }
  @media (max-width: 900px) { .nav-grid { grid-template-columns: 1fr; } }
  
  .rationale-wrapper { padding-top: 2rem; padding-bottom: 2rem; }
  .rationale-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; }
  .rationale-item .item-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
  .rationale-item h2 { font-size: 1.5rem; color: var(--color-primary); }
  .rationale-item svg { width: 28px; height: 28px; color: var(--color-primary); }
  .rationale-item p { color: var(--color-text-muted); }
  @media (max-width: 900px) { .rationale-grid { grid-template-columns: 1fr; } }

  .alignment-wrapper { padding-top: 2rem; padding-bottom: 2rem; }
  .alignment-box { background-color: var(--color-background); border-left: 4px solid var(--color-primary); padding: 2rem; border-radius: 4px; }
  .alignment-box .item-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
  .alignment-box h2 { font-size: 1.5rem; }
  .alignment-box svg { width: 28px; height: 28px; color: var(--color-primary); }
  .alignment-box p { color: var(--color-text-muted); max-width: 90ch; }

  .featured-newsletter-wrapper { padding-top: 2rem; padding-bottom: 2rem; }
  .featured-newsletter { display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; align-items: center; background-color: var(--color-white); padding: 3rem; border-radius: 12px; border: 1px solid var(--color-border); }
  .newsletter-content h2 { font-size: 2rem; line-height: 1.3; margin-bottom: 1rem; }
  .newsletter-content p { font-size: 1.1rem; color: var(--color-text-muted); margin-bottom: 2rem; }
  .testimonial-column { display: flex; align-items: center; justify-content: center; }
  .testimonial-slider { position: relative; width: 100%; transition: height 0.3s ease-in-out; }
  .testimonial-card { position: absolute; inset: 0; padding: 1rem; display: flex; flex-direction: column; justify-content: center; transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.6s ease-in-out; }
  .testimonial-card.is-active { transform: translateY(0); opacity: 1; z-index: 2; }
  .testimonial-card.is-leaving { transform: translateY(-100%); opacity: 0; z-index: 1; }
  .testimonial-card.is-waiting { transform: translateY(100%); opacity: 0; z-index: 1; }
  .testimonial-card .quote { font-size: 1.1rem; font-style: italic; line-height: 1.6; flex-grow: 1; }
  .testimonial-card .author { font-weight: 700; margin-top: 1rem; text-align: right; }
  @media (max-width: 900px) {
    .featured-newsletter { grid-template-columns: 1fr; }
    .testimonial-column { order: -1; margin-bottom: 2rem; min-height: 150px; }
  }
  .button-group { display: flex; flex-wrap: wrap; gap: 1rem; }
  .button { display: inline-block; background-color: var(--color-primary); color: var(--color-white); padding: 0.75rem 1.5rem; border: 2px solid var(--color-primary); border-radius: 4px; text-decoration: none; font-weight: 700; transition: all 0.2s ease; }
  .button:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  .button.button-secondary { background-color: var(--color-white); color: var(--color-primary); }
  .button.button-secondary:hover { background-color: var(--color-background); }
  .share-wrapper { padding-top: 2rem; padding-bottom: 4rem; }

  /* --- UVP CALLOUT STYLES --- */
  .uvp-wrapper {
    padding-top: 2rem;
    padding-bottom: 2rem;
  }
  .uvp-callout {
    background-color: var(--color-background);
    border-left: 4px solid var(--color-primary);
    padding: 2rem 2.5rem;
    border-radius: 4px;
  }
  .uvp-callout h2 {
    font-size: 1.75rem;
    margin-bottom: 1.5rem;
  }
  .uvp-callout ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .uvp-callout li {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    color: var(--color-text-muted);
    line-height: 1.6;
  }
  .uvp-callout li svg {
    width: 20px;
    height: 20px;
    color: var(--color-primary);
    flex-shrink: 0;
    margin-top: 0.25rem;
  }
  .uvp-callout li strong {
    color: var(--color-text);
  }

    /* --- VIDEO SECTION STYLES --- */
  .video-wrapper {
    padding-top: 2rem;
    padding-bottom: 2rem;
    text-align: center;
  }
  .video-header h2 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }
  .video-header p {
    font-size: 1.125rem;
    color: var(--color-text-muted);
    margin-bottom: 2.5rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  .video-embed-container {
    position: relative;
    width: 100%;
    max-width: 900px; /* UPDATED: Increased max-width for more resonance */
    margin: 0 auto; /* Center the larger container */
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    background-color: #000;
  }
  .video-embed-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

    /* --- NEW DEMO SECTION STYLES --- */
  .demo-wrapper {
    padding-top: 2rem;
    padding-bottom: 2rem;
    text-align: center;
  }
  .demo-header h2 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }
  .demo-header p {
    font-size: 1.125rem;
    color: var(--color-text-muted);
    margin-bottom: 2.5rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  .demo-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    text-align: left;
  }
  @media (max-width: 900px) {
    .demo-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</style>

